<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Leos 18 üéâ</title>
<meta name="description" content="Leos 18th birthday ‚Äî countdown, schedule, map, potluck, gallery, Spotify and more!" />
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=Lexend:wght@700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0b0b10;--bg2:#12121a;--panel:#161622;--ink:#eef3ff;--muted:#a0a8c0;--brand:#7c5cff;--brand2:#ff7cb2;--ok:#23d18b;--ring:0 0 0 .14rem #7c5cff55;--shadow:0 10px 40px rgba(0,0,0,.35);--r:16px}
[data-theme="light"]{--bg:#fffdfb;--bg2:#fff7f0;--panel:#ffffff;--ink:#17171b;--muted:#575b6d;--ring:0 0 0 .14rem #7c5cff33;--shadow:0 16px 40px rgba(24,12,60,.08)}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:Manrope,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;color:var(--ink);background:radial-gradient(1200px 800px at 10% -10%,#2d224a33,transparent 60%),radial-gradient(900px 700px at 110% -10%,#3b234a3a,transparent 50%),var(--bg);line-height:1.55}
a{color:inherit}
.wrap{max-width:1100px;margin:0 auto;padding:24px 20px 64px}
header.site{position:sticky;top:0;z-index:50;backdrop-filter:saturate(150%) blur(8px);background:color-mix(in srgb,var(--bg) 70%,transparent);border-bottom:1px solid #ffffff10}
header .inner{display:flex;justify-content:space-between;align-items:center;gap:16px;padding:12px 20px;max-width:1100px;margin:0 auto}
.logo{display:flex;align-items:center;gap:.7rem;font-family:Lexend,sans-serif;font-weight:800;letter-spacing:.5px}
.logo-badge{width:34px;height:34px;border-radius:10px;background:conic-gradient(from 220deg,var(--brand),var(--brand2),#ffcd73,var(--brand));box-shadow:inset 0 -4px 12px #0003,0 6px 22px #0006}
.toolbar{display:flex;gap:10px;align-items:center}
.btn,button,input[type=submit]{--bgc:var(--panel);--fg:var(--ink);appearance:none;border:1px solid #ffffff18;background:var(--bgc);color:var(--fg);padding:.72rem 1.05rem;border-radius:12px;font-weight:800;letter-spacing:.2px;box-shadow:var(--shadow);cursor:pointer;transition:.2s}
.btn:hover{transform:translateY(-1px)}
.btn.primary{--bgc:linear-gradient(93deg,var(--brand),var(--brand2));border:0;color:#fff}
.btn.ghost{background:transparent;border:1px dashed #a0a8c055}
.toggle{display:inline-flex;align-items:center;gap:.55rem;padding:.55rem .8rem;border-radius:999px;background:#ffffff10;border:1px solid #ffffff18;font-weight:600}
.toggle input{appearance:none;width:36px;height:22px;border-radius:999px;background:#ffffff22;position:relative;outline:none;border:1px solid #ffffff22}
.toggle input:after{content:'';width:16px;height:16px;border-radius:50%;background:#fff;position:absolute;top:2px;left:2px;transition:.2s}
.toggle input:checked{background:#9483ff}.toggle input:checked:after{left:18px}
.hero{display:grid;grid-template-columns:1.15fr 1fr;gap:24px;padding:32px 0 12px;align-items:center}
@media (max-width:900px){.hero{grid-template-columns:1fr}}
.card{background:linear-gradient(180deg,color-mix(in srgb,var(--panel) 90%,transparent),var(--panel));border:1px solid #ffffff18;border-radius:var(--r);box-shadow:var(--shadow)}
.panel{padding:22px}
h1{font-family:Lexend, sans-serif;font-size:clamp(2.1rem,5vw,3.1rem);line-height:1.05;margin:6px 0 10px;letter-spacing:.3px}
.lead{font-size:1.08rem;color:var(--muted)}
.countdown{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap}
.time{min-width:90px;text-align:center;border-radius:14px;padding:10px 12px;border:1px solid #ffffff18;background:#0002}
.time b{display:block;font-size:1.65rem;font-family:Lexend,sans-serif}
.cta-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:18px}
.canvas-stack{position:relative;min-height:260px;border-radius:var(--r);overflow:hidden}
canvas#confetti,canvas#fireworks{position:absolute;inset:0;width:100%;height:100%}
.mute{position:absolute;right:10px;bottom:10px}
.section{margin-top:38px}
.section h2{font-family:Lexend,sans-serif;font-size:1.6rem;margin:0 0 10px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
.col-4{grid-column:span 4}.col-6{grid-column:span 6}.col-8{grid-column:span 8}.col-12{grid-column:span 12}
@media (max-width:900px){.col-4,.col-6,.col-8{grid-column:span 12}}
/* Forms & table */
label{font-weight:800;font-size:.92rem;color:var(--muted)}
input[type=text],input[type=email],input[type=datetime-local],input[type=number],select,textarea{width:100%;padding:.8rem .9rem;border-radius:12px;border:1px solid #ffffff2b;background:#0f0f17;color:var(--ink);box-shadow:inset 0 1px 0 #ffffff05}
[data-theme=light] input,[data-theme=light] textarea,[data-theme=light] select{background:#fff;border-color:#e8e3ff}
textarea{min-height:88px;resize:vertical}
.pill{display:inline-flex;align-items:center;gap:.5rem;background:#ffffff10;border:1px solid #ffffff18;padding:.35rem .6rem;border-radius:999px;font-size:.88rem}
.table{width:100%;border-collapse:separate;border-spacing:0 10px}
.table tr{background:#0f0f18;border:1px solid #ffffff15}
.table td{padding:10px 12px}
.table tr td:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
.table tr td:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
[data-theme=light] .table tr{background:#fff}
/* Gallery */
.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
.gallery img{width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:12px;border:1px solid #ffffff14;cursor:pointer;transition:.15s;background:#222}
.gallery img:hover{transform:translateY(-2px)}
.lightbox{position:fixed;inset:0;background:#000d;display:none;align-items:center;justify-content:center;z-index:70}
.lightbox.active{display:flex}
.lightbox img{max-width:92vw;max-height:86vh;border-radius:16px;box-shadow:0 10px 60px #0009}
.lightbox .x{position:absolute;top:20px;right:20px}
/* Toast */
.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%) translateY(20px);padding:.7rem 1rem;border-radius:11px;background:#161629;border:1px solid #ffffff22;color:#fff;opacity:0;pointer-events:none;transition:.25s;z-index:80}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
/* Map */
.map-embed{width:100%;height:320px;border:0;border-radius:14px;filter:contrast(1.05) saturate(1.1)}
/* Hero photo */
.hero-photo{position:relative;overflow:hidden;border-radius:var(--r);min-height:260px;background:#111 url('data:image/svg+xml;utf8,<?xml version=\"1.0\"?><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"900\" height=\"600\"><rect width=\"100%\" height=\"100%\" fill=\"%23111111\"/><text x=\"50%\" y=\"52%\" fill=\"%23ffffff\" font-size=\"28\" font-family=\"sans-serif\" text-anchor=\"middle\">Drop a photo here or use URL below üì∏</text></svg>') center/cover no-repeat}
.hero-photo img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.hero-photo .controls{position:absolute;left:10px;bottom:10px;display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>
<body data-theme="dark">
<header class="site">
  <div class="inner">
    <div class="logo">
      <span class="logo-badge" aria-hidden="true"></span>
      <span>Leos 18</span>
    </div>
    <div class="toolbar">
      <label class="toggle" title="Theme">
        <span>üåô</span>
        <input id="themeToggle" type="checkbox" aria-label="Toggle light theme">
        <span>‚òÄÔ∏è</span>
      </label>
      <button id="launchConfetti" class="btn">üéä Confetti</button>
      <button id="launchFireworks" class="btn">üéÜ Fireworks</button>
    </div>
  </div>
</header>

<main class="wrap" id="top">
  <!-- HERO -->
  <section class="hero">
    <div class="card panel">
      <p class="pill">üéÇ Birthday Bash ‚Ä¢ <span id="bdayLabel">16 Aug, 20:00 (settable)</span></p>
      <h1>It‚Äôs happening ‚Äî let‚Äôs celebrate! <span style="background:linear-gradient(90deg,#ff9ad1,#ffd86b);-webkit-background-clip:text;-webkit-text-fill-color:transparent">See you there.</span></h1>
      <p class="lead">Countdown to party time. Effects, music, map & schedule below. Bring the vibes ‚ú®</p>

      <div class="countdown" aria-live="polite">
        <div class="time"><b id="d">‚Äì</b><small>Days</small></div>
        <div class="time"><b id="h">‚Äì</b><small>Hours</small></div>
        <div class="time"><b id="m">‚Äì</b><small>Minutes</small></div>
        <div class="time"><b id="s">‚Äì</b><small>Seconds</small></div>
      </div>

      <div class="cta-row">
        <a href="#schedule" class="btn primary">üìÖ Schedule</a>
        <a href="#map" class="btn">üìç Map</a>
        <a href="#music" class="btn">üéµ Music</a>
        <button id="partyMode" class="btn ghost" title="Effects on/off (no auto-music)">üéâ Party Mode</button>
      </div>

      <div class="section" style="margin-top:14px">
        <label for="dateTime">Change party date/time (local)</label>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <input type="datetime-local" id="dateTime">
          <button id="saveDate" class="btn primary">Save</button>
          <button id="resetDate" class="btn">Reset</button>
          <span id="dateSaved" class="lead" style="display:none;color:var(--ok)">Saved!</span>
        </div>
      </div>
    </div>

    <!-- Right side: effects canvas & music -->
    <div class="card canvas-stack" aria-hidden="true">
      <canvas id="confetti"></canvas>
      <canvas id="fireworks"></canvas>
      <button class="btn mute" id="musicToggle">üîà Music</button>
    </div>
  </section>

  <!-- HERO PHOTO (drop or URL, no code edits) -->
  <section class="section">
    <div class="hero-photo" id="heroDrop">
      <img id="heroImg" alt="Hero" style="display:none">
      <div class="controls">
        <input id="heroUrl" type="text" placeholder="Paste image URL..." style="padding:.6rem .8rem;border-radius:10px;border:1px solid #ffffff2b;background:#0006;color:#fff;min-width:240px">
        <button id="heroApply" class="btn">Use URL</button>
        <label class="btn ghost">Upload<input id="heroFile" type="file" accept="image/*" hidden></label>
        <button id="heroClear" class="btn">Clear</button>
      </div>
    </div>
  </section>

  <!-- SCHEDULE -->
  <section class="section" id="schedule">
    <div class="card panel">
      <h2>Schedule</h2>
      <div class="grid">
        <div class="col-12" id="scheduleList"></div>
      </div>
      <div class="chips" style="margin-top:8px">
        <span class="pill">Dress code: fancy casual (no suits needed)</span>
        <span class="pill">Theme: Neon Night</span>
      </div>
    </div>
  </section>

  <!-- POTLUCK SIGN-UP -->
  <section class="section" id="potluck">
    <div class="card panel">
      <h2>Potluck Sign-Up</h2>
      <p class="lead">Add what you‚Äôre bringing (saved in your browser).</p>
      <form id="potForm" style="display:flex;gap:10px;flex-wrap:wrap">
        <input id="potName" type="text" placeholder="Your name" required style="flex:1;min-width:180px">
        <input id="potItem" type="text" placeholder="I‚Äôll bring‚Ä¶" required style="flex:2;min-width:240px">
        <button class="btn primary">Add</button>
        <button class="btn" id="potClear" type="button">Clear All</button>
      </form>
      <div style="margin-top:12px;overflow:auto">
        <table class="table" id="potTable"><tbody></tbody></table>
      </div>
    </div>
  </section>

  <!-- MAP -->
  <section class="section" id="map">
    <div class="card panel">
      <h2>Where to go</h2>
      <p class="lead">Selsbakkvegen 5c</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px">
        <a target="_blank" rel="noopener" class="btn primary" id="openMaps">Open in Maps</a>
        <button class="btn" id="copyAddr">Copy address</button>
      </div>
      <iframe class="map-embed" id="mapFrame" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
        src=""></iframe>
    </div>
  </section>

  <!-- MUSIC / SPOTIFY -->
  <section class="section" id="music">
    <div class="card panel">
      <h2>Music</h2>
      <p class="lead">Paste a Spotify playlist/album/track. The player will embed and be remembered on this device.</p>
      <form id="spotifyForm" style="display:flex;gap:10px;flex-wrap:wrap">
        <input id="spotifyUrl" type="text" placeholder="https://open.spotify.com/playlist/..." style="flex:1;min-width:260px">
        <button class="btn primary" type="submit">Embed</button>
        <button class="btn" type="button" id="spotifyClear">Clear</button>
      </form>
      <div id="spotifyPlayer" style="margin-top:12px"></div>
      <div class="chips" style="margin-top:8px">
        <span class="pill">Tip: you can paste any playlist/album/track link</span>
        <span class="pill">Autoplay needs a click (browser rules)</span>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="spPlay">Play/Pause</button>
        <button class="btn" id="spOpenApp">Open in Spotify</button>
      </div>
    </div>
  </section>

  <!-- GALLERY -->
  <section class="section" id="gallery">
    <div class="card panel">
      <h2>Gallery</h2>
      <p class="lead">Click to view. Drag & drop your own images to add temporary previews.</p>
      <div class="gallery" id="galleryGrid" aria-live="polite">
        <!-- Preloaded placeholders -->
        <img alt="üéà" src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='%237c5cff'/><text x='50%' y='50%' font-size='60' text-anchor='middle' fill='white' dy='.3em'>üéà</text></svg>">
        <img alt="üéâ" src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='%23ff7cb2'/><text x='50%' y='50%' font-size='60' text-anchor='middle' fill='white' dy='.3em'>üéâ</text></svg>">
        <img alt="üéÇ" src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='%23ffd166'/><text x='50%' y='50%' font-size='60' text-anchor='middle' fill='black' dy='.3em'>üéÇ</text></svg>">
        <img alt="üì∏" src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='%2323d18b'/><text x='50%' y='50%' font-size='60' text-anchor='middle' fill='black' dy='.3em'>üì∏</text></svg>">
      </div>
    </div>
    <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Image preview">
      <button class="btn x">‚úï Close</button>
      <img alt="Preview">
    </div>
  </section>

  <footer style="margin:42px 0 10px;text-align:center;color:var(--muted);font-size:.95rem">
    Made for Leo‚Äôs 18th with üíú ‚Äî share the link!
    <div style="margin-top:6px"><a class="btn" href="#top">Back to top</a></div>
  </footer>
</main>

<div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
/* ---------- utils ---------- */
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const toast=(t,ms=1800)=>{const el=$("#toast");el.textContent=t;el.classList.add("show");setTimeout(()=>el.classList.remove("show"),ms);}
const store={get(k,f){try{const v=localStorage.getItem(k);return v?JSON.parse(v):f}catch(_){return f}},set(k,v){localStorage.setItem(k,JSON.stringify(v))},del(k){localStorage.removeItem(k)}};

/* ---------- theme ---------- */
const THEME_KEY="bday_theme";
const themeToggle=$("#themeToggle");
(function initTheme(){
  const saved=store.get(THEME_KEY,"dark");
  document.body.dataset.theme=saved;
  themeToggle.checked=saved==="light";
})();
themeToggle.addEventListener("change",()=>{document.body.dataset.theme=themeToggle.checked?"light":"dark";store.set(THEME_KEY,document.body.dataset.theme);});

/* ---------- schedule ---------- */
const scheduleItems=[
  {time:"20:00",label:"Guests arrive üçπ"},
  {time:"21:00",label:"Food is served üçΩÔ∏è"},
  {time:"00:00",label:"Cake & champagne üéÇü•Ç"},
];
(function renderSchedule(){
  const wrap=$("#scheduleList");
  wrap.innerHTML=scheduleItems.map(i=>`
    <div class="table"><table><tbody>
      <tr><td style="width:120px;font-family:Lexend,sans-serif;font-weight:700">${i.time}</td><td>${i.label}</td></tr>
    </tbody></table></div>
  `).join("");
})();

/* ---------- countdown ---------- */
const DT_KEY="bday_datetime";
const dEl=$("#d"),hEl=$("#h"),mEl=$("#m"),sEl=$("#s");
const dateInput=$("#dateTime"),saveBtn=$("#saveDate"),resetBtn=$("#resetDate"),label=$("#bdayLabel");
const partyDefaults = {year: 2025, month: 8, day: 16, hour: 20, minute: 0}; // 16/08 20:00

function toLocalInputValue(y,m,d,hh,mm){
  const dt=new Date(y, m-1, d, hh, mm);
  const off=dt.getTimezoneOffset(); // minutes
  const local=new Date(dt.getTime()-off*60000);
  return local.toISOString().slice(0,16);
}
let target=store.get(DT_KEY,null);
if(!target){ target=toLocalInputValue(partyDefaults.year,partyDefaults.month,partyDefaults.day,partyDefaults.hour,partyDefaults.minute); store.set(DT_KEY,target); }
dateInput.value=target; label.textContent=new Date(target).toLocaleString();

saveBtn.addEventListener("click",()=>{ if(!dateInput.value){toast("Pick a date/time"); return;} store.set(DT_KEY,dateInput.value); target=dateInput.value; label.textContent=new Date(target).toLocaleString(); $("#dateSaved").style.display="inline"; setTimeout(()=>$("#dateSaved").style.display="none",1200); });
resetBtn.addEventListener("click",()=>{ store.del(DT_KEY); target=toLocalInputValue(partyDefaults.year,partyDefaults.month,partyDefaults.day,partyDefaults.hour,partyDefaults.minute); dateInput.value=target; store.set(DT_KEY,target); label.textContent=new Date(target).toLocaleString(); });

let partyStarted=false, midnightBoomed=false;
function tick(){
  const t = new Date(target);
  let diff = t - new Date();
  if(isNaN(diff)){ dEl.textContent=hEl.textContent=mEl.textContent=sEl.textContent="‚Äì"; return; }
  if(diff<=0){
    dEl.textContent=hEl.textContent=mEl.textContent=sEl.textContent="00";
    if(!partyStarted){ partyStarted=true; toast("Party started! üéâ"); spawnConfetti(240); }
  } else {
    const d=Math.floor(diff/86400000); diff-=d*86400000;
    const h=Math.floor(diff/3600000); diff-=h*3600000;
    const m=Math.floor(diff/60000);   diff-=m*60000;
    const s=Math.floor(diff/1000);
    dEl.textContent=String(d).padStart(2,"0");
    hEl.textContent=String(h).padStart(2,"0");
    mEl.textContent=String(m).padStart(2,"0");
    sEl.textContent=String(s).padStart(2,"0");
  }
  // Extra: midnight fireworks on party night
  const now=new Date();
  if (!midnightBoomed){
    const partyDate = new Date(target);
    const isPartySpan = now >= partyDate && now <= new Date(partyDate.getTime()+6*3600e3); // until +6h
    if(isPartySpan && now.getHours()===0 && now.getMinutes()===0 && now.getSeconds()<5){
      boomCenter(); midnightBoomed=true; toast("Midnight! üéÜ");
    }
  }
}
setInterval(tick,1000); tick();

/* ---------- canvases: confetti & fireworks ---------- */
const confettiCanvas=$("#confetti"), fwCanvas=$("#fireworks");
const ctxC=confettiCanvas.getContext("2d"), ctxF=fwCanvas.getContext("2d");
function resizeCanvas(){[confettiCanvas,fwCanvas].forEach(c=>{c.width=c.clientWidth;c.height=c.clientHeight;});}
new ResizeObserver(resizeCanvas).observe($(".canvas-stack"));

let confetti=[];
function spawnConfetti(n=120){
  for(let i=0;i<n;i++){
    confetti.push({x:Math.random()*confettiCanvas.width,y:-10-Math.random()*80,r:4+Math.random()*6,vx:-1+Math.random()*2,vy:2+Math.random()*2.5,col:`hsl(${Math.random()*360},90%,60%)`,rot:Math.random()*Math.PI,spin:(-.1+.2*Math.random())});
  }
}
function drawConfetti(){
  ctxC.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confetti.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.rot+=p.spin;ctxC.save();ctxC.translate(p.x,p.y);ctxC.rotate(p.rot);ctxC.fillStyle=p.col;ctxC.fillRect(-p.r,-p.r/2,p.r*2,p.r);ctxC.restore();});
  confetti=confetti.filter(p=>p.y<confettiCanvas.height+20);
  requestAnimationFrame(drawConfetti);
}
drawConfetti();

let fireworks=[];
function explode(x,y,hue=Math.random()*360){const count=70;for(let i=0;i<count;i++){const a=(i/count)*Math.PI*2;const s=2+Math.random()*3;fireworks.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:60+Math.random()*20,col:`hsl(${hue},100%,${60+Math.random()*20}%)`});}}
function drawFireworks(){ctxF.fillStyle="rgba(0,0,0,.15)";ctxF.fillRect(0,0,fwCanvas.width,fwCanvas.height);fireworks.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=0.03;p.life-=1;ctxF.beginPath();ctxF.arc(p.x,p.y,2,0,Math.PI*2);ctxF.fillStyle=p.col;ctxF.fill();});fireworks=fireworks.filter(p=>p.life>0);requestAnimationFrame(drawFireworks);}
drawFireworks();
function boomCenter(){explode(fwCanvas.width*.5, fwCanvas.height*.4);}

$("#launchConfetti").addEventListener("click",()=>{spawnConfetti(180);toast("Confetti! üéä");});
$("#launchFireworks").addEventListener("click",()=>{explode(fwCanvas.width*(.25+.5*Math.random()), fwCanvas.height*(.25+.5*Math.random()));toast("Boom! üéÜ");});

/* ---------- Party mode (effects only; no auto-music per your choice) ---------- */
let partyOn=false;
$("#partyMode").addEventListener("click",()=>{partyOn=!partyOn;if(partyOn){spawnConfetti(220);boomCenter();toast("Party mode ON üéâ");}else{toast("Party mode OFF");}});

/* ---------- Music button (no auto-play; just a label toggle) ---------- */
$("#musicToggle").addEventListener("click",()=>{toast("Use the Spotify player below to control music");});

/* ---------- Hero photo uploader / URL (no code edits needed) ---------- */
const HERO_KEY="hero_img_data";
const heroImg=$("#heroImg"), heroUrl=$("#heroUrl"), heroFile=$("#heroFile"), heroApply=$("#heroApply"), heroClear=$("#heroClear"), heroDrop=$("#heroDrop");
(function loadHero(){const saved=store.get(HERO_KEY,null);if(saved){heroImg.src=saved;heroImg.style.display="block";}})();
async function fileToDataURL(file){return await new Promise(res=>{const r=new FileReader();r.onload=()=>res(r.result);r.readAsDataURL(file);});}
heroApply.addEventListener("click",()=>{const u=heroUrl.value.trim();if(!u){toast("Paste an image URL");return}heroImg.src=u;heroImg.style.display="block";store.set(HERO_KEY,u);toast("Hero image set ‚úÖ");});
heroFile.addEventListener("change",async e=>{const f=e.target.files[0];if(!f)return;const data=await fileToDataURL(f);heroImg.src=data;heroImg.style.display="block";store.set(HERO_KEY,data);toast("Hero image uploaded ‚úÖ");});
heroClear.addEventListener("click",()=>{store.del(HERO_KEY);heroImg.removeAttribute("src");heroImg.style.display="none";heroUrl.value="";toast("Hero image cleared");});
["dragenter","dragover"].forEach(evt=>heroDrop.addEventListener(evt,e=>{e.preventDefault();heroDrop.style.outline="2px dashed #7c5cff";heroDrop.style.outlineOffset="6px";}));
["dragleave","drop"].forEach(evt=>heroDrop.addEventListener(evt,e=>{e.preventDefault();heroDrop.style.outline="none";}));
heroDrop.addEventListener("drop",async e=>{const f=[...e.dataTransfer.files].find(f=>/^image\\//.test(f.type));if(!f)return;const data=await fileToDataURL(f);heroImg.src=data;heroImg.style.display="block";store.set(HERO_KEY,data);toast("Hero image set from drop ‚úÖ");});

/* ---------- Map embed + links ---------- */
const addressRaw="Selsbakkvegen 5c";
const q=encodeURIComponent(addressRaw);
const mapURL=`https://www.google.com/maps?q=${q}&output=embed`;
const appURL=`https://www.google.com/maps?q=${q}`;
$("#mapFrame").src=mapURL;
$("#openMaps").href=appURL;
$("#copyAddr").addEventListener("click",async()=>{try{await navigator.clipboard.writeText(addressRaw);toast("Address copied üìã")}catch(_){toast(addressRaw);} });

/* ---------- Potluck ---------- */
const POT_KEY="bday_potluck";
const potForm=$("#potForm"), potTable=$("#potTable tbody"), potName=$("#potName"), potItem=$("#potItem");
function loadPot(){return store.get(POT_KEY,[])} function savePot(v){store.set(POT_KEY,v)}
function renderPot(){const list=loadPot();potTable.innerHTML=list.length?list.map((p,i)=>`<tr><td><b>${p.name.replace(/</g,"&lt;")}</b></td><td>${p.item.replace(/</g,"&lt;")}</td><td style="width:1%"><button class="btn ghost del" data-i="${i}">Del</button></td></tr>`).join(""):`<tr><td style="padding:12px;color:var(--muted)">No items yet. Add yours!</td></tr>`;$$(".del").forEach(b=>b.addEventListener("click",e=>{const i=+e.currentTarget.dataset.i;const cur=loadPot();cur.splice(i,1);savePot(cur);renderPot();}));}
renderPot();
potForm.addEventListener("submit",e=>{e.preventDefault();const n=potName.value.trim(), it=potItem.value.trim(); if(!n||!it){toast("Enter name & item");return;} const cur=loadPot();cur.push({name:n,item:it,at:new Date().toISOString()});savePot(cur);renderPot();potForm.reset();toast("Added to potluck üß∫");});
$("#potClear").addEventListener("click",()=>{if(confirm("Clear all potluck items on this device?")){savePot([]);renderPot();}});

/* ---------- Spotify embed ---------- */
const SPOTIFY_KEY="bday_spotify";
const spForm=$("#spotifyForm"), spInput=$("#spotifyUrl"), spPlayer=$("#spotifyPlayer");
function toSpotifyEmbed(url){try{const u=new URL(url.trim());if(u.hostname!=="open.spotify.com")return null;const parts=u.pathname.split("/").filter(Boolean);if(parts.length<2)return null;const type=parts[0],id=parts[1];return {embed:`https://open.spotify.com/embed/${type}/${id}?utm_source=generator`, open:`https://open.spotify.com/${type}/${id}`};}catch(_){return null}}
function renderSpotify(){const saved=store.get(SPOTIFY_KEY,null);if(!saved){spPlayer.innerHTML='<div class="lead" style="color:var(--muted)">No Spotify link yet.</div>';return;} spPlayer.innerHTML=`<iframe id="spFrame" style="border-radius:12px" src="${saved.embed}" width="100%" height="352" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>`; spInput.value=saved.open;}
renderSpotify();
spForm?.addEventListener("submit",e=>{e.preventDefault();const eUrl=toSpotifyEmbed(spInput.value);if(!eUrl){toast("Paste a valid Spotify playlist/album/track URL");return;}store.set(SPOTIFY_KEY,eUrl);renderSpotify();toast("Spotify added üéµ");});
$("#spotifyClear").addEventListener("click",()=>{store.del(SPOTIFY_KEY);renderSpotify();toast("Spotify cleared");});
$("#spOpenApp").addEventListener("click",()=>{const saved=store.get(SPOTIFY_KEY,null); if(!saved){toast("Add a Spotify link first");return;} window.open(saved.open,"_blank");});
$("#spPlay").addEventListener("click",()=>{toast("Press Play inside the embedded player (browser policy)"); const iframe=$("#spFrame"); if(iframe){iframe.focus();}});

/* ---------- Gallery + lightbox + drag&drop ---------- */
const gallery=$("#galleryGrid"), lightbox=$("#lightbox"), lbImg=$("#lightbox img"), lbClose=$("#lightbox .x");
gallery.addEventListener("click",e=>{const t=e.target.closest("img");if(!t)return;lbImg.src=t.src;lightbox.classList.add("active");});
lbClose.addEventListener("click",()=>lightbox.classList.remove("active"));
lightbox.addEventListener("click",e=>{if(e.target===lightbox)lightbox.classList.remove("active")});
["dragenter","dragover"].forEach(evt=>gallery.addEventListener(evt,e=>{e.preventDefault();e.stopPropagation();gallery.style.outline="2px dashed #7c5cff";gallery.style.outlineOffset="6px";}));
["dragleave","drop"].forEach(evt=>gallery.addEventListener(evt,e=>{e.preventDefault();e.stopPropagation();gallery.style.outline="none";}));
gallery.addEventListener("drop",e=>{const files=Array.from(e.dataTransfer.files).filter(f=>/^image\\//.test(f.type));files.forEach(f=>{const url=URL.createObjectURL(f);const img=new Image();img.alt=f.name;img.src=url;img.onload=()=>URL.revokeObjectURL(url);gallery.prepend(img);});toast("Added preview images üì∏");});

/* ---------- keyboard niceties ---------- */
document.addEventListener("keydown",e=>{if(e.key==="Escape")lightbox.classList.remove("active");if(e.key.toLowerCase()==="c")spawnConfetti(120);if(e.key.toLowerCase()==="f")explode(fwCanvas.width*Math.random(),fwCanvas.height*(.3+.5*Math.random()));});

/* ---------- first layout ---------- */
function firstLayout(){resizeCanvas();} firstLayout();
</script>
</body>
</html>
