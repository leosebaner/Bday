<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>üéâ Birthday Bash</title>
  <meta name="description" content="Birthday party site: RSVP, countdown, wishes, gallery, fireworks & confetti!" />
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=Lexend:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0b0b10;
      --bg-soft: #12121a;
      --panel: #161622;
      --ink: #eef3ff;
      --muted: #a0a8c0;
      --brand: #7c5cff;
      --brand-2: #ff7cb2;
      --ok: #23d18b;
      --warn: #ffd166;
      --danger: #ff5d5d;
      --ring: 0 0 0 .14rem #7c5cff55;
      --shadow: 0 10px 40px rgba(0,0,0,.35);
      --radius: 16px;
    }
    [data-theme="light"]{
      --bg: #fffdfb;
      --bg-soft:#fff7f0;
      --panel:#ffffff;
      --ink:#17171b;
      --muted:#575b6d;
      --ring: 0 0 0 .14rem #7c5cff33;
      --shadow: 0 16px 40px rgba(24,12,60,.08);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: 'Manrope',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;
      color:var(--ink); background: radial-gradient(1200px 800px at 10% -10%, #2d224a33, transparent 60%) , radial-gradient(900px 700px at 110% -10%, #3b234a3a, transparent 50%), var(--bg);
      line-height:1.55;
    }
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:24px 20px 64px}
    header.site{
      position:sticky; top:0; z-index:50;
      backdrop-filter:saturate(150%) blur(8px);
      background: color-mix(in srgb, var(--bg) 70%, transparent);
      border-bottom:1px solid #ffffff10;
    }
    header .inner{display:flex;justify-content:space-between;align-items:center;gap:16px; padding:12px 20px; max-width:1100px;margin:0 auto}
    .logo{
      display:flex;align-items:center;gap:.7rem;
      font-family:'Lexend',sans-serif; font-weight:800; letter-spacing:.5px;
    }
    .logo-badge{
      width:34px;height:34px;border-radius:10px;
      background: conic-gradient(from 220deg, var(--brand), var(--brand-2), #ffcd73, var(--brand));
      box-shadow: inset 0 -4px 12px #00000033, 0 6px 22px #00000035;
    }
    .toolbar{display:flex;gap:10px;align-items:center}
    .btn, button, input[type="submit"]{
      --bgc: var(--panel); --fg: var(--ink);
      appearance:none;border:1px solid #ffffff18;background:var(--bgc);color:var(--fg);
      padding:.72rem 1.05rem;border-radius:12px;font-weight:800;letter-spacing:.2px;
      box-shadow: var(--shadow); cursor:pointer; transition: .2s ease;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{--bgc: linear-gradient(93deg, var(--brand), var(--brand-2)); border:0; color:white}
    .btn.ghost{background:transparent;border:1px dashed #a0a8c055}
    .toggle{
      display:inline-flex;align-items:center;gap:.55rem;padding:.55rem .8rem;border-radius:999px;background:#ffffff10;border:1px solid #ffffff18;font-weight:600
    }
    .toggle input{appearance:none;width:36px;height:22px;border-radius:999px;background:#ffffff22;position:relative;outline:none;border:1px solid #ffffff22}
    .toggle input:after{content:'';width:16px;height:16px;border-radius:50%;background:white;position:absolute;top:2px;left:2px;transition:.2s}
    .toggle input:checked{background:#9483ff}
    .toggle input:checked:after{left:18px}
    .hero{
      display:grid;grid-template-columns:1.3fr 1fr; gap:24px; padding:32px 0 12px; align-items:center;
    }
    @media (max-width:900px){ .hero{grid-template-columns:1fr} }
    .card{
      background:linear-gradient(180deg, color-mix(in srgb, var(--panel) 90%, transparent), var(--panel));
      border:1px solid #ffffff18; border-radius:var(--radius); box-shadow: var(--shadow);
    }
    .panel{padding:22px}
    h1{
      font-family:'Lexend',sans-serif; font-size: clamp(2.2rem, 5vw, 3.1rem);
      line-height:1.05; margin: 6px 0 10px;
      letter-spacing:.3px;
    }
    .lead{font-size:1.08rem;color:var(--muted)}
    .countdown{
      display:flex; gap:10px; margin-top:16px; flex-wrap:wrap;
    }
    .time{
      min-width:90px;text-align:center;border-radius:14px;padding:10px 12px;border:1px solid #ffffff18;background:#00000022
    }
    .time b{display:block;font-size:1.65rem; font-family:'Lexend',sans-serif}
    .cta-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:18px}
    .canvas-stack{position:relative;min-height:260px;border-radius:var(--radius);overflow:hidden}
    canvas#confetti, canvas#fireworks{position:absolute;inset:0;width:100%;height:100%}
    .mute{position:absolute;right:10px;bottom:10px}
    .section{margin-top:38px}
    .section h2{
      font-family:'Lexend',sans-serif; font-size:1.6rem; margin:0 0 10px;
    }
    .grid{display:grid;grid-template-columns: repeat(12, 1fr); gap:16px}
    .col-4{grid-column: span 4}
    .col-6{grid-column: span 6}
    .col-8{grid-column: span 8}
    .col-12{grid-column: span 12}
    @media (max-width:900px){
      .col-4,.col-6,.col-8{grid-column:span 12}
    }

    /* RSVP form */
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .form-grid .full{grid-column:1/-1}
    label{font-weight:800; font-size:.92rem; color:var(--muted)}
    input[type="text"],input[type="email"],input[type="datetime-local"],select,textarea{
      width:100%;padding:.8rem .9rem;border-radius:12px;border:1px solid #ffffff2b;background:#0f0f17;color:var(--ink);
      box-shadow: inset 0 1px 0 #ffffff05;
    }
    [data-theme="light"] input, [data-theme="light"] textarea, [data-theme="light"] select{
      background:#fff;border-color:#e8e3ff;
    }
    textarea{min-height:88px;resize:vertical}
    .pill{display:inline-flex;align-items:center;gap:.5rem;background:#ffffff10;border:1px solid #ffffff18;padding:.35rem .6rem;border-radius:999px;font-size:.88rem}
    .table{width:100%;border-collapse:separate;border-spacing:0 10px}
    .table tr{background:#0f0f18;border:1px solid #ffffff15}
    .table td{padding:10px 12px}
    .table tr{border-radius:10px}
    .table tr td:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
    .table tr td:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
    [data-theme="light"] .table tr{background:#fff}

    /* Wish wall */
    .wish-grid{display:grid;grid-template-columns: repeat(auto-fit, minmax(230px,1fr)); gap:12px}
    .wish{
      border:1px solid #ffffff18;border-radius:14px;padding:12px; background:
        radial-gradient(220px 160px at 100% 0%, #ff7cb208, transparent 60%),
        radial-gradient(240px 160px at 0% 100%, #7c5cff0a, transparent 60%),
        #0f0f18;
      position:relative;
      min-height:110px;
    }
    .wish .author{font-weight:800;color:#ffddf3;margin-top:6px}
    .wish .date{color:#a0a8c0;font-size:.85rem}
    .wish .del{
      position:absolute; right:8px; top:8px;
      background:#ffffff12; border:1px solid #ffffff25; border-radius:10px;
      font-size:.78rem; padding:.25rem .5rem; cursor:pointer;
    }

    /* Gallery */
    .gallery{display:grid;grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:10px}
    .gallery img{
      width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:12px; border:1px solid #ffffff14;
      cursor:pointer; transition: .15s ease; background:#222;
    }
    .gallery img:hover{transform: translateY(-2px)}
    .lightbox{
      position:fixed; inset:0; background:#000000dd; display:none; align-items:center; justify-content:center; z-index:70;
    }
    .lightbox.active{display:flex}
    .lightbox img{max-width:92vw; max-height:86vh; border-radius:16px; box-shadow:0 10px 60px #0009}
    .lightbox .x{position:absolute;top:20px;right:20px}

    /* Footer */
    footer{margin:42px 0 10px;text-align:center;color:var(--muted);font-size:.95rem}

    /* Fun chips */
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border-radius:999px;padding:.5rem .9rem;border:1px solid #ffffff22;background:#ffffff0e}
    .chip svg{vertical-align:-2px}

    /* Schedule list */
    .schedule{display:grid;gap:10px}
    .sched-item{
      display:grid;grid-template-columns: 120px auto; gap:14px; align-items:start;
      background:#0f0f18;border:1px solid #ffffff15;border-radius:12px; padding:12px
    }
    .sched-time{font-family:'Lexend',sans-serif; font-weight:700}
    [data-theme="light"] .sched-item{background:#fff;border-color:#ede8ff}

    /* Toast */
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%) translateY(20px);
      padding:.7rem 1rem;border-radius:11px;background:#161629;border:1px solid #ffffff22;color:#fff;opacity:0;pointer-events:none;transition:.25s;z-index:80
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
  </style>
</head>
<body data-theme="dark">
  <header class="site">
    <div class="inner">
      <div class="logo">
        <span class="logo-badge" aria-hidden="true"></span>
        <span>Birthday Bash</span>
      </div>
      <div class="toolbar">
        <label class="toggle" title="Theme">
          <span>üåô</span>
          <input id="themeToggle" type="checkbox" aria-label="Toggle light theme">
          <span>‚òÄÔ∏è</span>
        </label>
        <button id="launchConfetti" class="btn">üéä Confetti</button>
        <button id="launchFireworks" class="btn">üéÜ Fireworks</button>
      </div>
    </div>
  </header>

  <main class="wrap" id="top">
    <!-- HERO -->
    <section class="hero">
      <div class="card panel">
        <p class="pill">üéÇ My Birthday ‚Ä¢ <span id="bdayLabel">Set your date ‚Üì</span></p>
        <h1>Let‚Äôs celebrate! <span style="background:linear-gradient(90deg,#ff9ad1,#ffd86b);-webkit-background-clip:text;-webkit-text-fill-color:transparent">You‚Äôre invited.</span></h1>
        <p class="lead">Countdown, RSVP, leave a wish, browse memories, and get party details. Make yourself at home!</p>

        <div class="countdown" aria-live="polite">
          <div class="time"><b id="d">‚Äì</b><small>Days</small></div>
          <div class="time"><b id="h">‚Äì</b><small>Hours</small></div>
          <div class="time"><b id="m">‚Äì</b><small>Minutes</small></div>
          <div class="time"><b id="s">‚Äì</b><small>Seconds</small></div>
        </div>

        <div class="cta-row">
          <a href="#rsvp" class="btn primary">RSVP Now</a>
          <a href="#wishes" class="btn">Write a Wish</a>
          <button id="partyMode" class="btn ghost" title="Play music & effects">üéâ Party Mode</button>
        </div>
      </div>

      <div class="card canvas-stack" aria-hidden="true">
        <canvas id="confetti"></canvas>
        <canvas id="fireworks"></canvas>
        <audio id="music" src="music.mp3" preload="none" loop></audio>
        <button class="btn mute" id="musicToggle">üîä Music</button>
      </div>
    </section>

    <!-- DATE PICKER -->
    <section class="section">
      <div class="card panel">
        <div class="grid">
          <div class="col-6">
            <h2>Set the date & time</h2>
            <p class="lead">Pick your birthday moment to power the countdown (saved on your device).</p>
            <div class="form-grid">
              <div class="full">
                <label for="dateTime">Birthday</label>
                <input type="datetime-local" id="dateTime" />
              </div>
              <div class="full">
                <button id="saveDate" class="btn primary">Save Date</button>
                <button id="resetDate" class="btn">Reset</button>
              </div>
            </div>
            <p id="dateSaved" class="lead" style="margin-top:8px;display:none;color:var(--ok)">Saved!</p>
          </div>
          <div class="col-6">
            <h2>Party schedule</h2>
            <div class="schedule" id="scheduleList" aria-live="polite">
              <!-- filled at runtime -->
            </div>
            <div class="chips" style="margin-top:8px">
              <span class="chip">Dress code: ‚ú® comfy glam</span>
              <span class="chip">Theme: Neon Night</span>
              <span class="chip">Hashtag: #BDayVibes</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RSVP -->
    <section class="section" id="rsvp">
      <div class="card panel">
        <h2>RSVP</h2>
        <p class="lead">Let me know if you‚Äôre coming! You can export the list as JSON later.</p>
        <form id="rsvpForm" autocomplete="on">
          <div class="form-grid">
            <div>
              <label for="name">Name</label>
              <input id="name" type="text" required placeholder="Taylor Swift (jk)">
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" type="email" required placeholder="you@example.com">
            </div>
            <div>
              <label for="attending">Attending?</label>
              <select id="attending" required>
                <option value="Yes" selected>Yes</option>
                <option value="Maybe">Maybe</option>
                <option value="No">No</option>
              </select>
            </div>
            <div>
              <label for="guests"># of Guests</label>
              <input id="guests" type="number" min="0" max="20" value="0">
            </div>
            <div class="full">
              <label for="notes">Notes (allergies, etc.)</label>
              <textarea id="notes" placeholder="I‚Äôm gluten-free, can I bring a friend?"></textarea>
            </div>
          </div>
          <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
            <button class="btn primary" type="submit">Add RSVP</button>
            <button class="btn" type="button" id="exportRSVP">Export JSON</button>
            <label class="btn ghost" for="importFile" style="cursor:pointer">Import JSON<input id="importFile" type="file" accept="application/json" hidden></label>
          </div>
        </form>

        <div style="margin-top:18px;overflow:auto">
          <table class="table" id="rsvpTable" aria-describedby="rsvp">
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- WISH WALL -->
    <section class="section" id="wishes">
      <div class="card panel">
        <h2>Wish Wall</h2>
        <p class="lead">Leave a birthday message. It‚Äôll stick around on this device.</p>
        <form id="wishForm">
          <div class="form-grid">
            <div>
              <label for="wAuthor">Your Name</label>
              <input id="wAuthor" type="text" placeholder="Your name" required>
            </div>
            <div class="full">
              <label for="wText">Your Wish</label>
              <textarea id="wText" required placeholder="Say something sweet ‚ú®"></textarea>
            </div>
          </div>
          <div style="margin-top:10px">
            <button class="btn primary">Post Wish</button>
            <button class="btn" id="clearWishes" type="button">Clear All</button>
          </div>
        </form>

        <div class="wish-grid" id="wishList" style="margin-top:14px"></div>
      </div>
    </section>

    <!-- GALLERY -->
    <section class="section" id="gallery">
      <div class="card panel">
        <h2>Gallery</h2>
        <p class="lead">Drop your own images into the same folder and update the list below, or drag & drop here to add temporarily.</p>
        <div class="gallery" id="galleryGrid" aria-live="polite">
          <!-- Placeholder images (solid color SVGs) -->
          <img alt="Memory 1" src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='%237c5cff'/><text x='50%' y='50%' font-size='60' text-anchor='middle' fill='white' dy='.3em'>üéà</text></svg>">
          <img alt="Memory 2" src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='%23ff7cb2'/><text x='50%' y='50%' font-size='60' text-anchor='middle' fill='white' dy='.3em'>üéâ</text></svg>">
          <img alt="Memory 3" src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='%23ffd166'/><text x='50%' y='50%' font-size='60' text-anchor='middle' fill='black' dy='.3em'>üéÇ</text></svg>">
          <img alt="Memory 4" src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='%2323d18b'/><text x='50%' y='50%' font-size='60' text-anchor='middle' fill='black' dy='.3em'>üì∏</text></svg>">
        </div>
        <div class="chips" style="margin-top:12px">
          <span class="chip">Tip: drag & drop images here to preview</span>
        </div>
      </div>

      <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Image preview">
        <button class="btn x">‚úï Close</button>
        <img alt="Preview">
      </div>
    </section>

    <!-- GIFTS / IDEAS -->
    <section class="section" id="gifts">
      <div class="card panel">
        <h2>Gift Ideas</h2>
        <p class="lead">Not required at all, but if you insist ü•π here are some ideas:</p>
        <div class="grid">
          <div class="col-4">
            <div class="card panel">
              <h3>üéß Vinyl or Music</h3>
              <p>Indie pop, R&B, city pop. Surprise me!</p>
              <span class="pill">Budget: $10‚Äì$30</span>
            </div>
          </div>
          <div class="col-4">
            <div class="card panel">
              <h3>üç´ Snacks from abroad</h3>
              <p>I love trying sweets from different countries.</p>
              <span class="pill">Budget: $10‚Äì$20</span>
            </div>
          </div>
          <div class="col-4">
            <div class="card panel">
              <h3>üß∏ Hand-written letter</h3>
              <p>Costs nothing, means everything.</p>
              <span class="pill">Budget: $0 ‚ù§Ô∏è</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      Made with üíú ‚Äî share this link with friends!
      <div style="margin-top:6px">
        <a class="btn" href="#top">Back to top</a>
      </div>
    </footer>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
  // --- small helpers ---
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const store = {
    get(k, fallback){ try{ const v=localStorage.getItem(k); return v? JSON.parse(v): fallback }catch(e){ return fallback } },
    set(k, v){ localStorage.setItem(k, JSON.stringify(v)) },
    del(k){ localStorage.removeItem(k) }
  }
  const fmt = n => n.toString().padStart(2,'0');
  const toast = (t, ms=1800)=>{ const el=$('#toast'); el.textContent=t; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'), ms); }

  // --- theme ---
  const THEME_KEY = 'bday_theme';
  const themeToggle = $('#themeToggle');
  const initTheme = () => {
    const saved = store.get(THEME_KEY, 'dark');
    document.body.dataset.theme = saved;
    themeToggle.checked = saved === 'light';
  };
  initTheme();
  themeToggle.addEventListener('change', () => {
    document.body.dataset.theme = themeToggle.checked ? 'light' : 'dark';
    store.set(THEME_KEY, document.body.dataset.theme);
  });

  // --- schedule defaults ---
  const scheduleDefault = [
    { time: '18:00', label:'Doors open + welcome drinks' },
    { time: '19:00', label:'Dinner & toasts' },
    { time: '20:15', label:'Games & photos' },
    { time: '21:00', label:'Cake cutting üéÇ' },
    { time: '21:30', label:'Dance floor ü™©' },
  ];
  function renderSchedule(items){
    const wrap = $('#scheduleList');
    wrap.innerHTML = items.map(i => `
      <div class="sched-item">
        <div class="sched-time">${i.time}</div>
        <div>${i.label}</div>
      </div>
    `).join('');
  }
  renderSchedule(store.get('schedule', scheduleDefault));

  // --- countdown ---
  const DT_KEY = 'bday_datetime';
  const dateInput = $('#dateTime');
  const saveDateBtn = $('#saveDate');
  const resetDateBtn = $('#resetDate');
  const bdayLabel = $('#bdayLabel');

  let target = store.get(DT_KEY, null);
  if(target){ dateInput.value = target; bdayLabel.textContent = new Date(target).toLocaleString() }

  saveDateBtn.addEventListener('click', () => {
    if(!dateInput.value){ toast('Pick a date & time'); return }
    store.set(DT_KEY, dateInput.value);
    target = dateInput.value;
    bdayLabel.textContent = new Date(target).toLocaleString();
    $('#dateSaved').style.display = 'block';
    setTimeout(()=>$('#dateSaved').style.display='none', 1200);
  });
  resetDateBtn.addEventListener('click', () => {
    store.del(DT_KEY);
    dateInput.value = '';
    bdayLabel.textContent = 'Set your date ‚Üì';
    target = null;
  });

  function tick(){
    const now = new Date();
    const t = target ? new Date(target) : null;
    let diff = t ? (t - now) : 0;
    if(!t || isNaN(diff)){ $('#d').textContent='‚Äì'; $('#h').textContent='‚Äì'; $('#m').textContent='‚Äì'; $('#s').textContent='‚Äì'; return }
    if(diff <= 0){
      $('#d').textContent='00'; $('#h').textContent='00'; $('#m').textContent='00'; $('#s').textContent='00';
      return;
    }
    const d = Math.floor(diff/86400000); diff -= d*86400000;
    const h = Math.floor(diff/3600000);   diff -= h*3600000;
    const m = Math.floor(diff/60000);     diff -= m*60000;
    const s = Math.floor(diff/1000);
    $('#d').textContent = fmt(d);
    $('#h').textContent = fmt(h);
    $('#m').textContent = fmt(m);
    $('#s').textContent = fmt(s);
  }
  setInterval(tick, 1000); tick();

  // --- confetti & fireworks (simple) ---
  const confettiCanvas = $('#confetti');
  const fwCanvas = $('#fireworks');
  const ctxC = confettiCanvas.getContext('2d');
  const ctxF = fwCanvas.getContext('2d');

  function resizeCanvas(){
    [confettiCanvas, fwCanvas].forEach(c => { c.width = c.clientWidth; c.height = c.clientHeight; });
  }
  new ResizeObserver(resizeCanvas).observe($('.canvas-stack'));

  // confetti particles
  let confetti = [];
  function spawnConfetti(n=120){
    for(let i=0;i<n;i++){
      confetti.push({
        x: Math.random()*confettiCanvas.width,
        y: -10 - Math.random()*80,
        r: 4 + Math.random()*6,
        vx: -1 + Math.random()*2,
        vy: 2 + Math.random()*2.5,
        col: `hsl(${Math.random()*360},90%,60%)`,
        rot: Math.random()*Math.PI, spin: (-.1+.2*Math.random())
      });
    }
  }
  function drawConfetti(){
    ctxC.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
    confetti.forEach(p=>{
      p.x += p.vx; p.y += p.vy; p.rot += p.spin;
      ctxC.save();
      ctxC.translate(p.x, p.y);
      ctxC.rotate(p.rot);
      ctxC.fillStyle = p.col;
      ctxC.fillRect(-p.r, -p.r/2, p.r*2, p.r);
      ctxC.restore();
    });
    confetti = confetti.filter(p=>p.y < confettiCanvas.height+20);
    requestAnimationFrame(drawConfetti);
  }
  drawConfetti();

  // fireworks particles
  let fireworks = [];
  function explode(x,y, hue = Math.random()*360){
    const count = 70;
    for(let i=0;i<count;i++){
      const angle = (i/count)*Math.PI*2;
      const speed = 2 + Math.random()*3;
      fireworks.push({
        x,y,
        vx: Math.cos(angle)*speed,
        vy: Math.sin(angle)*speed,
        life: 60 + Math.random()*20,
        col: `hsl(${hue}, 100%, ${60+Math.random()*20}%)`
      });
    }
  }
  function drawFireworks(){
    ctxF.fillStyle = 'rgba(0,0,0,0.15)';
    ctxF.fillRect(0,0,fwCanvas.width, fwCanvas.height);
    fireworks.forEach(p=>{
      p.x += p.vx; p.y += p.vy; p.vy += 0.03; p.life -= 1;
      ctxF.beginPath(); ctxF.arc(p.x,p.y,2,0,Math.PI*2);
      ctxF.fillStyle = p.col; ctxF.fill();
    });
    fireworks = fireworks.filter(p=>p.life>0);
    requestAnimationFrame(drawFireworks);
  }
  drawFireworks();

  $('#launchConfetti').addEventListener('click', ()=>{ spawnConfetti(180); toast('Confetti! üéä') });
  $('#launchFireworks').addEventListener('click', ()=>{
    const x = fwCanvas.width*(.25 + .5*Math.random());
    const y = fwCanvas.height*(.25 + .5*Math.random());
    explode(x,y);
    toast('Boom! üéÜ');
  });

  // Party Mode
  const audio = $('#music');
  let partyOn = false;
  $('#partyMode').addEventListener('click', async ()=>{
    partyOn = !partyOn;
    if(partyOn){
      spawnConfetti(220);
      explode(fwCanvas.width*0.5, fwCanvas.height*0.4);
      try{ await audio.play(); }catch(_){} // autoplay may be blocked
      toast('Party mode ON üéâ');
    } else {
      audio.pause();
      toast('Party mode OFF');
    }
  });

  // Music toggle
  const musicToggle = $('#musicToggle');
  musicToggle.addEventListener('click', async ()=>{
    if(audio.paused){ try{ await audio.play(); musicToggle.textContent='üîä Music'; }catch(_){ toast('Click again to allow audio'); } }
    else { audio.pause(); musicToggle.textContent='üîà Muted'; }
  });

  // --- RSVP storage ---
  const RSVP_KEY = 'bday_rsvp';
  const rsvpForm = $('#rsvpForm');
  const rsvpTable = $('#rsvpTable tbody');

  function loadRSVP(){ return store.get(RSVP_KEY, []) }
  function saveRSVP(list){ store.set(RSVP_KEY, list) }
  function renderRSVP(){
    const list = loadRSVP();
    if(!list.length){ rsvpTable.innerHTML = `<tr><td style="padding:12px;color:var(--muted)">No RSVPs yet. Be the first!</td></tr>`; return }
    rsvpTable.innerHTML = list.map((r,i)=>`
      <tr>
        <td><b>${r.name}</b><div class="muted">${r.email}</div></td>
        <td>${r.attending}</td>
        <td>${r.guests ?? 0} guests</td>
        <td>${r.notes ? r.notes.replace(/</g,'&lt;') : ''}</td>
        <td style="width:1%"><button data-i="${i}" class="btn ghost small delrs">Delete</button></td>
      </tr>
    `).join('');
    $$('.delrs').forEach(b=>b.addEventListener('click', e=>{
      const i = +e.currentTarget.dataset.i;
      const cur = loadRSVP(); cur.splice(i,1); saveRSVP(cur); renderRSVP();
    }));
  }
  renderRSVP();

  rsvpForm.addEventListener('submit', e=>{
    e.preventDefault();
    const r = {
      name: $('#name').value.trim(),
      email: $('#email').value.trim(),
      attending: $('#attending').value,
      guests: +$('#guests').value || 0,
      notes: $('#notes').value.trim(),
      at: new Date().toISOString()
    };
    if(!r.name || !r.email){ toast('Name & email required'); return }
    const list = loadRSVP();
    list.push(r); saveRSVP(list); renderRSVP();
    rsvpForm.reset();
    toast('RSVP added üéüÔ∏è');
  });

  // Export / Import
  $('#exportRSVP').addEventListener('click', ()=>{
    const data = JSON.stringify(loadRSVP(), null, 2);
    const url = URL.createObjectURL(new Blob([data], {type:'application/json'}));
    const a = document.createElement('a'); a.href = url; a.download = 'rsvp.json'; a.click(); URL.revokeObjectURL(url);
  });
  $('#importFile').addEventListener('change', async (e)=>{
    const file = e.target.files[0]; if(!file) return;
    const text = await file.text();
    try{ const json = JSON.parse(text); if(Array.isArray(json)){ saveRSVP(json); renderRSVP(); toast('Imported! ‚úÖ'); } }
    catch{ toast('Bad JSON file', 2000) }
    e.target.value = '';
  });

  // --- Wishes ---
  const WISH_KEY = 'bday_wishes';
  function loadW(){ return store.get(WISH_KEY, []) }
  function saveW(list){ store.set(WISH_KEY, list) }
  const wishList = $('#wishList');
  function renderWishes(){
    const list = loadW().sort((a,b)=> b.at.localeCompare(a.at));
    wishList.innerHTML = list.map((w,i)=>`
      <article class="wish">
        <button class="del" data-i="${i}" title="Delete">‚úï</button>
        <div>${w.text.replace(/</g,'&lt;')}</div>
        <div class="author">‚Äî ${w.author.replace(/</g,'&lt;')}</div>
        <div class="date">${new Date(w.at).toLocaleString()}</div>
      </article>
    `).join('');
    $$('.wish .del').forEach(b=>b.addEventListener('click', e=>{
      const i = +e.currentTarget.dataset.i; const cur = loadW(); cur.splice(i,1); saveW(cur); renderWishes();
    }));
  }
  renderWishes();

  $('#wishForm').addEventListener('submit', e=>{
    e.preventDefault();
    const w = {
      author: $('#wAuthor').value.trim() || 'Anonymous',
      text: $('#wText').value.trim(),
      at: new Date().toISOString()
    };
    if(!w.text){ toast('Write something first üíå'); return }
    const list = loadW(); list.push(w); saveW(list); renderWishes();
    e.target.reset(); spawnConfetti(80); toast('Wish posted ‚ú®');
  });
  $('#clearWishes').addEventListener('click', ()=>{
    if(confirm('Clear all wishes on this device?')){ saveW([]); renderWishes(); }
  });

  // --- Gallery drag & drop + lightbox ---
  const gallery = $('#galleryGrid');
  const lightbox = $('#lightbox');
  const lbImg = $('#lightbox img');
  const lbClose = $('#lightbox .x');

  gallery.addEventListener('click', e=>{
    const t = e.target.closest('img'); if(!t) return;
    lbImg.src = t.src; lightbox.classList.add('active');
  });
  lbClose.addEventListener('click', ()=> lightbox.classList.remove('active'));
  lightbox.addEventListener('click', e=>{ if(e.target === lightbox) lightbox.classList.remove('active') });

  // drag & drop temporary previews
  ['dragenter','dragover'].forEach(evt=> gallery.addEventListener(evt, e=>{
    e.preventDefault(); e.stopPropagation(); gallery.style.outline='2px dashed #7c5cff'; gallery.style.outlineOffset='6px';
  }));
  ['dragleave','drop'].forEach(evt=> gallery.addEventListener(evt, e=>{
    e.preventDefault(); e.stopPropagation(); gallery.style.outline='none';
  }));
  gallery.addEventListener('drop', e=>{
    const files = Array.from(e.dataTransfer.files).filter(f=>/^image\\//.test(f.type));
    files.forEach(f=>{
      const url = URL.createObjectURL(f);
      const img = new Image(); img.alt = f.name; img.src = url; img.onload = ()=> URL.revokeObjectURL(url);
      gallery.prepend(img);
    });
    toast('Added preview images üì∏');
  });

  // --- keyboard niceties ---
  document.addEventListener('keydown', e=>{
    if(e.key === 'Escape') lightbox.classList.remove('active');
    if(e.key.toLowerCase() === 'c'){ spawnConfetti(120) }
    if(e.key.toLowerCase() === 'f'){ explode(fwCanvas.width*Math.random(), fwCanvas.height*(.3+.5*Math.random())) }
    if(e.key.toLowerCase() === 'm'){ musicToggle.click() }
  });

  // first layout sizing
  resizeCanvas();
  </script>
</body>
</html>
